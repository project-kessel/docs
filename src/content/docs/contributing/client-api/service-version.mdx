---
title: "Package: {service}.{major_version}"
docType: client-package
package:
  classes:
    - name: ClientBuilder
      description: | 
        A builder for constructing [stubs](https://en.wikipedia.org/wiki/Stub_(distributed_computing)) 
        for the package's service and version with "out of the box" defaults. 
        These defaults configure recommending settings and integrations defined by the Kessel team.

        If you would like more control over channel or stub construction, use the gRPC API directly,
        though this is not recommended.

        Example:

        ```python
        inventory = inventory.v1beta2.ClientBuilder(target)
            .oauth2ClientAuthenticated(OAuth2ClientCredentials(
                client_id="example",
                client_secret="example",
                token_url="example.com/token))
            .build()
        ```
      constructors:
        - description: Start a builder using the provided `target` URI.
          params:
            - name: target
              type:
                name: string
              description: | 
                The target URI for routing and discovery.

                For gRPC the scheme of the URI determines how name resolution works. `dns://` will use
                DNS to resolve the host name to IPs and service configuration (from a TXT record).

                Omitting a scheme is valid. In that case, "dns" is used.

                For more information, see the [gRPC docs](https://grpc.io/docs/what-is-grpc/).

                **Default configuration:** 
                - Use runtime-default TLS configuration for channel credential
                - Python should enable use of single-threaded unary streams when asyncio is not used
                - Otherwise, uses stock gRPC defaults (note: *no* keep alive)
      methods:
        - name: oauth2ClientAuthenticated
          description: Configures CallCredentials using the OAuth2 Client Credentials grant.
          params:
            - name: oauth2ClientCredentials
              type:
                name: OAuth2ClientCredentials
                link: ../auth/#class-OAuth2ClientCredentials
              description: |
                  Configures the OAuth2 Client Credentials grant in order to authenticate the client for each remote procedure call (RPC). Tokens are refreshed automatically when needed.
            - name: channelCredentials
              type:
                name: ChannelCredentials
                link: https://grpc.io/docs/guides/auth/#credential-types
              optional: true
              description: |
                The gRPC `ChannelCredentials` to use for each channel connection. This authenticates the server (e.g. through TLS) and, optionally, your client (e.g. through mutual TLS).

                If not explicitly provided, the ClientBuilder MUST default to using TLS to authenticate the server with the runtime's default trust bundle and TLS configuration.
        - name: authenticated
          params: 
            - name: callCredentials
              type: 
                name: CallCredentials
                link: https://grpc.io/docs/guides/auth/#credential-types
              optional: true
              description: |
                The gRPC `CallCredentials` to use for each remote procedure call (RPC). This authenticates the client to the server.

                See `oauth2ClientAuthenticated` to authenticate using OAuth2 Client Credentials.
            - name: channelCredential
              type: 
                name: ChannelCredentials
                link: https://grpc.io/docs/guides/auth/#credential-types
              optional: true
              description: See above `ChannelCredentials` param description.
        - name: unauthenticated
          params:
            - name: channelCredential
              type: 
                name: ChannelCredentials
                link: https://grpc.io/docs/guides/auth/#credential-types
              optional: true
              description: See above `ChannelCredentials` param description.
          description: |
            Configures only a `ChannelCredentials` to secure communication with the server.
            The client is not authenticated.
        - name: insecure
          description: Configures insecure communication with the server (e.g. for testing). Neither the client nor the server is authenticated.
        - name: build
          description: |
            Constructs the generated stub for the package's service and version following the builder's configuration.

            **Resource Management**: Some languages (e.g. Python, Java, Go) have connection abstractions that are separate from the stub
            (Python: Channel, Java: ManagedChannel, Go: Client) and require explicit cleanup to prevent resource leaks.

            **Return Value**:
            - If the stub has a `close()` method: return the stub directly
            - If the stub lacks a `close()` method: return a tuple `(Stub, Closeable)` where `Closeable` is the resource that needs cleanup

            This pattern ensures consistent resource management across all language implementations.
          returns:
            name: "{Service}Stub (and possibly the channel â€“ see description)"
        - name: buildAsync
          languages: ["Python", "JavaScript"]
          returns:
            name: "(Async) {Service}Stub"
          description: | 
            Like build, but constructs a stub with async primitives.

            For JavaScript, this returns a Promise-based stub API.

            For Python, this returns a stub using asyncio.

            **Implementation note:** Wrapping the generated stubs is not ideal, but if it has to be done,
            ensure the wrapper is consistent with the stub API.

  functions:
    - name: workspace_type
      description: |
        Function to create a RepresentationType for workspace resources.
        Returns a protobuf RepresentationType configured for RBAC workspace objects.

        Example:

        ```python
        workspace_type = workspace_type()
        ```
      params: []
      returns:
        name: RepresentationType
        link: https://buf.build/project-kessel/inventory-api/docs/main:kessel.inventory.v1beta2#kessel.inventory.v1beta2.RepresentationType
        description: A RepresentationType for workspace resources

    - name: role_type
      description: |
        Function to create a RepresentationType for role resources.
        Returns a protobuf RepresentationType configured for RBAC role objects.

        Example:

        ```python
        role_type = role_type()
        ```
      params: []
      returns:
        name: RepresentationType
        link: https://buf.build/project-kessel/inventory-api/docs/main:kessel.inventory.v1beta2#kessel.inventory.v1beta2.RepresentationType
        description: A RepresentationType for role resources

    - name: principal_resource
      description: |
        Creates a ResourceReference for a user principal based on user ID and domain.
        This function standardizes the creation of principal resources.

        Example:

        ```python
        user_resource = principal_resource("123", "redhat")
        ```
      params:
        - name: id
          type:
            name: string
          description: The user identifier
        - name: domain
          type:
            name: string
          description: The domain or organization the user belongs to
      returns:
        name: ResourceReference
        link: https://buf.build/project-kessel/inventory-api/docs/main:kessel.inventory.v1beta2#kessel.inventory.v1beta2.ResourceReference
        description: A ResourceReference pointing to the user's principal resource

    - name: role_resource
      description: |
        Function to create a ResourceReference for a role.
        Returns a protobuf ResourceReference configured for RBAC role resources.

        Example:

        ```python
        admin_role = role_resource("admin")
        ```
      params:
        - name: resource_id
          type:
            name: string
          description: The role identifier
      returns:
        name: ResourceReference
        link: https://buf.build/project-kessel/inventory-api/docs/main:kessel.inventory.v1beta2#kessel.inventory.v1beta2.ResourceReference
        description: A ResourceReference for the role

    - name: workspace_resource
      description: |
        Function to create a ResourceReference for a workspace.
        Returns a protobuf ResourceReference configured for RBAC workspace resources.

        Example:

        ```python
        project_workspace = workspace_resource("project-abc")
        ```
      params:
        - name: resource_id
          type:
            name: string
          description: The workspace identifier
      returns:
        name: ResourceReference
        link: https://buf.build/project-kessel/inventory-api/docs/main:kessel.inventory.v1beta2#kessel.inventory.v1beta2.ResourceReference
        description: A ResourceReference for the workspace

    - name: principal_subject_for_user_id
      description: |
        Creates a SubjectReference for a user principal based on user ID and domain.
        This is a convenience function that wraps principal_resource to create a subject reference.

        Example:

        ```python
        user_subject = principal_subject_for_user_id("john.doe", "example.com")
        ```
      params:
        - name: id
          type:
            name: string
          description: The user identifier
        - name: domain
          type:
            name: string
          description: The domain or organization the user belongs to
      returns:
        name: SubjectReference
        link: https://buf.build/project-kessel/inventory-api/docs/main:kessel.inventory.v1beta2#kessel.inventory.v1beta2.SubjectReference
        description: A SubjectReference for the user's principal

    - name: list_workspaces
      description: |
        Lists all workspaces that a subject has a specific relation to.
        This function queries the inventory service to find workspaces based on the subject's permissions.

        Example:

        ```python
        user_subject = principal_subject_for_user_id("john.doe", "redhat.com")
        workspaces = list_workspaces(user_subject, "member", inventory_client)
        for workspace in workspaces:
            print(f"User has access to workspace: {workspace.resource.resource_id}")
        ```
      params:
        - name: subject
          type:
            name: SubjectReference
            link: https://buf.build/project-kessel/inventory-api/docs/main:kessel.inventory.v1beta2#kessel.inventory.v1beta2.SubjectReference
          description: The subject (typically a user principal) to check permissions for
        - name: relation
          type:
            name: string
          description: The relationship type to check (e.g., "member", "admin", "viewer")
        - name: inventory
          type:
            name: KesselInventoryServiceStub
          description: The inventory service client stub for making the request
      returns:
        name: "AsyncIterator[StreamedListObjectsResponse] | Iterable[StreamedListObjectsResponse]"
        link: https://buf.build/project-kessel/inventory-api/docs/main:kessel.inventory.v1beta2#kessel.inventory.v1beta2.StreamedListObjectsResponse
        description: An iterator of workspace objects that the subject has the specified relation to
---

Package for code specific to service and API version, where `{service}` is the separately versioned service (e.g. "inventory" or "rbac") and `{major_version}` is the major revision of the API (e.g. v1beta2, v1, v2), such as generated client code.

:::note
This import may be controlled by the layout, package, or options declared in the proto spec of gRPC APIs. This means the proto needs to define these accordingly based on the proto's own package or option declarations.
:::

Hand-written code MAY be added to these package(s), if it is version-specific.

- This MAY depend on peer packages.
- For example, middleware or utilities which integrate with this version can be placed here (such as `{prefix}.rbac.v2` for easy Workspace lookups).

`.rbac` (or any other `{service}`) may be nested for RBAC/service-specific utilities which are also specific to that service-API version.

- For example, `{prefix}.inventory.v1beta2.rbac` for creating SubjectReferences, ResourceReferences, etc, following RBAC's well-known schema).

## Special notes about ClientBuilder

:::caution
Implement language specifics in the `ClientBuilder`s carefully.
:::

The [`ClientBuilder`](#class-ClientBuilder) incorporates best practices for that language. This means by definition, behavior may be language specific in more ways than is typical of this specification.

For example, in the Python reference implementation, the default configuration, when not using asyncio, might use single-threaded unary streams for a performance improvement.

Additionally, not all languages are consistent in their treatment of `Channels`, `ChannelOptions`, and Stub configuration. In this case, the `ClientBuilder` is meant to be consistent *despite* these differences, within reason. For example, in some languages (Python, Go), everything meaningful is configured on the Channel itself. In some languages (Java), the stub itself contains CallOptions. In some languages, the Channel provides built-in methods for configuring it. In other languages, you have to provide CallOptions yourself, etc.

While the builders are specific to a service and version, they MAY delegate to or inherit from generic gRPC code in the `grpc` package (e.g., a base class).
