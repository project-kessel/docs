---
title: "Package: {service}.{major_version}"
docType: client-package
package:
  classes:
    - name: ClientBuilder
      description: | 
        A builder for constructing [stubs](https://en.wikipedia.org/wiki/Stub_(distributed_computing)) 
        for the package's service and version with "out of the box" defaults. 
        These defaults configure recommending settings and integrations defined by the Kessel team.

        If you would like more control over channel or stub construction, use the gRPC API directly,
        though this is not recommended.

        Example:

        ```python
        inventory = inventory.v1beta2.ClientBuilder(target)
            .oauth2ClientAuthenticated(OAuth2ClientCredentials(
                client_id="example",
                client_secret="example",
                token_url="example.com/token))
            .build()
        ```
      constructors:
        - description: Start a builder using the provided `target` URI.
          params:
            - name: target
              type:
                name: string
              description: | 
                The target URI for routing and discovery.

                For gRPC the scheme of the URI determines how name resolution works. `dns://` will use
                DNS to resolve the host name to IPs and service configuration (from a TXT record).

                Omitting a scheme is valid. In that case, "dns" is used.

                For more information, see the [gRPC docs](https://grpc.io/docs/what-is-grpc/).

                **Default configuration:** 
                - Use runtime-default TLS configuration for channel credential
                - Python should enable use of single-threaded unary streams when asyncio is not used
                - Otherwise, uses stock gRPC defaults (note: *no* keep alive)
      methods:
        - name: oauth2ClientAuthenticated
          description: Configures CallCredentials using the OAuth2 Client Credentials grant.
          params:
            - name: oauth2ClientCredentials
              type:
                name: OAuth2ClientCredentials
                link: ../auth/#class-OAuth2ClientCredentials
              description: |
                  Configures the OAuth2 Client Credentials grant in order to authenticate the client for each remote procedure call (RPC). Tokens are refreshed automatically when needed.
            - name: channelCredentials
              type:
                name: ChannelCredentials
                link: https://grpc.io/docs/guides/auth/#credential-types
              optional: true
              description: |
                The gRPC `ChannelCredentials` to use for each channel connection. This authenticates the server (e.g. through TLS) and, optionally, your client (e.g. through mutual TLS).

                If not explicitly provided, the ClientBuilder MUST default to using TLS to authenticate the server with the runtime's default trust bundle and TLS configuration.
        - name: authenticated
          params: 
            - name: callCredentials
              type: 
                name: CallCredentials
                link: https://grpc.io/docs/guides/auth/#credential-types
              optional: true
              description: |
                The gRPC `CallCredentials` to use for each remote procedure call (RPC). This authenticates the client to the server.

                See `oauth2ClientAuthenticated` to authenticate using OAuth2 Client Credentials.
            - name: channelCredential
              type: 
                name: ChannelCredentials
                link: https://grpc.io/docs/guides/auth/#credential-types
              optional: true
              description: See above `ChannelCredentials` param description.
        - name: unauthenticated
          params:
            - name: channelCredential
              type: 
                name: ChannelCredentials
                link: https://grpc.io/docs/guides/auth/#credential-types
              optional: true
              description: See above `ChannelCredentials` param description.
          description: |
            Configures only a `ChannelCredentials` to secure communication with the server.
            The client is not authenticated.
        - name: insecure
          description: Configures insecure communication with the server (e.g. for testing). Neither the client nor the server is authenticated.
        - name: build
          description: |
            Constructs the generated stub for the package's service and version following the builder's configuration.

            **Resource Management**: Some languages (e.g. Python, Java, Go) have connection abstractions that are separate from the stub
            (Python: Channel, Java: ManagedChannel, Go: Client) and require explicit cleanup to prevent resource leaks.

            **Return Value**:
            - If the stub has a `close()` method: return the stub directly
            - If the stub lacks a `close()` method: return a tuple `(Stub, Closeable)` where `Closeable` is the resource that needs cleanup

            This pattern ensures consistent resource management across all language implementations.
          returns:
            name: "{Service}Stub (and possibly the channel â€“ see description)"
        - name: buildAsync
          languages: ["Python", "JavaScript"]
          returns:
            name: "(Async) {Service}Stub"
          description: | 
            Like build, but constructs a stub with async primitives.

            For JavaScript, this returns a Promise-based stub API.

            For Python, this returns a stub using asyncio.

            **Implementation note:** Wrapping the generated stubs is not ideal, but if it has to be done,
            ensure the wrapper is consistent with the stub API.

  functions:
    - name: get_root_workspace
      description: |
        Gets the root workspace for the specified organization.
        This function queries RBAC v2 to find the root workspace for the given org_id.
        
        GET /v2/workspaces?type=root
        
        Example:
        
        ```python
        import requests
        
        # Configure HTTP client with authentication headers
        http_client = requests.Session()
        http_client.headers.update({
            "x-rh-rbac-psk": "your-pre-shared-key",
            "x-rh-rbac-client-id": "client-id"
        })
        
        # Get the root workspace
        root_workspace = get_root_workspace(
            http_client=http_client,
            rbac_base_endpoint="https://console.stage.redhat.com/",
            org_id="12345"
        )
        print(f"Root workspace: {root_workspace['name']}")
        workspace_id = root_workspace["id"]
        ```
      params:
        - name: http_client
          type:
            name: "http.Client"
          description: |
            Pre-configured HTTP client with required headers like authentication. 
        - name: rbac_base_endpoint
          type:
            name: string
          description: The RBAC service endpoint URL (stage/prod/ephemeral)
        - name: org_id
          type:
            name: string
          description: Organization ID to use for the request. Will be encoded in the x-rh-identity header
      returns:
        name: "Dict[str, Any]"
        description: |
          A dictionary containing the root workspace object with fields like:
          - `id`: Workspace identifier
          - `name`: Workspace name
          - `type`: Workspace type ("root")
          - `description`: Workspace description

    - name: get_default_workspace
      description: |
        Gets the default workspace for the specified organization.
        This function queries RBAC v2 to find the default workspace for the given org_id.
        
        GET /v2/workspaces?type=default
        
        Example:
        
        ```python
        import requests
        
        # Configure HTTP client with authentication headers
        http_client = requests.Session()
        http_client.headers.update({
            "x-rh-rbac-psk": "your-pre-shared-key",
            "x-rh-rbac-client-id": "client-id"
        })
        
        # Get the default workspace
        default_workspace = get_default_workspace(
            http_client=http_client,
            rbac_base_endpoint="https://console.stage.redhat.com/",
            org_id="12345"
        )
        print(f"Default workspace: {default_workspace['name']}")
        workspace_id = default_workspace["id"]
        ```
      params:
        - name: http_client
          type:
            name: "http.Client"
          description: |
            Pre-configured HTTP client with required headers like authentication. 
        - name: rbac_base_endpoint
          type:
            name: string
          description: The RBAC service endpoint URL (stage/prod/ephemeral)
        - name: org_id
          type:
            name: string
          description: Organization ID to use for the request. Will be encoded in the x-rh-identity header
      returns:
        name: "Dict[str, Any]"
        description: |
          A dictionary containing the default workspace object with fields like:
          - `id`: Workspace identifier
          - `name`: Workspace name
          - `type`: Workspace type ("default")
          - `description`: Workspace description
---

Package for code specific to service and API version, where `{service}` is the separately versioned service (e.g. "inventory" or "rbac") and `{major_version}` is the major revision of the API (e.g. v1beta2, v1, v2), such as generated client code.

:::note
This import may be controlled by the layout, package, or options declared in the proto spec of gRPC APIs. This means the proto needs to define these accordingly based on the proto's own package or option declarations.
:::

Hand-written code MAY be added to these package(s), if it is version-specific.

- This MAY depend on peer packages.
- For example, middleware or utilities which integrate with this version can be placed here (such as `{prefix}.rbac.v2` for easy Workspace lookups).

`.rbac` (or any other `{service}`) may be nested for RBAC/service-specific utilities which are also specific to that service-API version.

- For example, `{prefix}.inventory.v1beta2.rbac` for creating SubjectReferences, ResourceReferences, etc, following RBAC's well-known schema).

## Special notes about ClientBuilder

:::caution
Implement language specifics in the `ClientBuilder`s carefully.
:::

The [`ClientBuilder`](#class-ClientBuilder) incorporates best practices for that language. This means by definition, behavior may be language specific in more ways than is typical of this specification.

For example, in the Python reference implementation, the default configuration, when not using asyncio, might use single-threaded unary streams for a performance improvement.

Additionally, not all languages are consistent in their treatment of `Channels`, `ChannelOptions`, and Stub configuration. In this case, the `ClientBuilder` is meant to be consistent *despite* these differences, within reason. For example, in some languages (Python, Go), everything meaningful is configured on the Channel itself. In some languages (Java), the stub itself contains CallOptions. In some languages, the Channel provides built-in methods for configuring it. In other languages, you have to provide CallOptions yourself, etc.

While the builders are specific to a service and version, they MAY delegate to or inherit from generic gRPC code in the `grpc` package (e.g., a base class).
