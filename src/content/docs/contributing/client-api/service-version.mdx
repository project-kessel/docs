---
title: "Package: {service}.{major_version}"
docType: client-package
package:
  classes:
    - name: ClientBuilder
      description: | 
        A builder for constructing gRPC [stubs](https://en.wikipedia.org/wiki/Stub_(distributed_computing)) for the package's service and version with "out of the box" 
        defaults. These defaults configure recommending settings defined by the Kessel team.

        If you would like more control over channel or stub construction, use the gRPC API directly.
      constructors:
        - description: Start a builder using the provided `target` URI.
          params:
            - name: target
              type:
                name: string
              description: | 
                The target URI for routing and discovery.

                The scheme of the URI determines how name resolution works. `dns://` will use
                DNS to resolve the host name to IPs and service configuration (from a TXT record).

                Omitting a scheme is valid. In that case, "dns" is used.

                For more information, see the gRPC docs.
      methods:
        - name: oauth2ClientCredentials
          description: Configures CallCredentials using the OAuth2 Client Credentials grant.
          params:
            - name: oauth2ClientCredentials
              type:
                name: OAuth2ClientCredentials
                link: ../auth/#class-OAuth2ClientCredentials
            - name: channelCredentials
              type:
                name: ChannelCredentials
                link: https://grpc.io/docs/guides/auth/#credential-types
              optional: true
              description: |
                The gRPC `ChannelCredentials` to use for each channel connection. This authenticates the server (e.g. through TLS) and, optionally, your client (e.g. through mutual TLS).

                If not explicitly provided, the ClientBuilder MUST default to using TLS to authenticate the server with the runtime's default trust bundle and TLS configuration.
---

import { Aside } from "@astrojs/starlight/components"

Package for code specific to service and API version, where `{service}` is the separately versioned service (e.g. "inventory" or "rbac") and `{major_version}` is the major revision of the API (e.g. v1beta2, v1, v2), such as generated client code.

<Aside>
This import may be controlled by the layout, package, or options declared in the proto spec of gRPC APIs. This means the proto needs to define these accordingly based on the proto's own package or option declarations.
</Aside>

Hand-written code MAY be added to these package(s), if it is version-specific.

- This MAY depend on peer packages.
- For example, middleware or utilities which integrate with this version can be placed here (such as `{prefix}.rbac.v2` for easy Workspace lookups).

`.rbac` (or any other `{service}`) may be nested for RBAC/service-specific utilities which are also specific to that service-API version.

- For example, `{prefix}.inventory.v1beta2.rbac` for creating SubjectReferences, ResourceReferences, etc, following RBAC's well-known schema).

## ClientBuilder

SHOULD expose a `ClientBuilder` for constructing channels and stubs using best practices and available middleware (e.g. authentication) specific to that service & major version.

- This SHOULD have a notion of "[default](../../client-libraries/#defaults-across-all-languages)" configuration which incorporates best practices generally, specific to that language, and which apply to that service-version. Different constructor permutations should allow applying these "defaults" easily.
  - For example, in the Python reference implementation, the "default" configuration, when not using asyncio, uses single-threaded unary streams for a performance improvement.
- This SHOULD have a constructor which accepts a `Configuration` object which reads common configuration values, consistent from language to language (e.g. with the same common keys, same environment variables, etc).
- This SHOULD expose `build` methods which construct stubs for that API version.
- This MAY delegate or inherit from generic gRPC code in the `grpc` package.
- **Note:** Not all languages are consistent in their treatment of `Channels`, `ChannelOptions`, and Stub configuration. The `ClientBuilder` is meant to be consistent despite these differences, within reason.
  - For example, in some languages (Python, Go), everything meaningful is configured on the Channel itself. In some languages (Java), the stub contains CallOptions. In some languages, the Channel provides built-in methods for configuring it. In other languages, you have to provide CallOptions yourself, etc.
