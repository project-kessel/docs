---
title: Getting Started with RBAC
description: Step-by-step instructions for installing and running Kessel with your first managed and access controlled resource.
---

import { Aside, Card, CardGrid, LinkButton, Steps, Tabs, TabItem, Code } from '@astrojs/starlight/components';
import SdkExamples from 'src/components/SdkExamples.astro';

import commonRepresentation from 'src/examples/document/common_representation.json?raw';
import documentConfig from 'src/examples/document/config.yaml?raw';
import driveConfig from 'src/examples/document/reporters/drive/config.yaml?raw';
import driveHost from 'src/examples/document/reporters/drive/document.json?raw';
import driveSchema from 'src/examples/drive.ksl?raw';
import rbacSchema from 'src/examples/rbac.ksl?raw';
import kesselSchema from 'src/examples/kessel.ksl?raw';
import schemaZed from 'src/examples/schema.zed?raw';

This tutorial walks you through setting up Kessel from scratch with a basic document management example. 
You'll learn how to configure schemas, set up RBAC permissions, install client libraries, 
and implement both resource reporting and access control using Kessel's APIs across multiple programming languages.

<Aside type="tip" title="Tip: Insights migration guide">
If you are migrating an existing Red Hat Insights application to Kessel, follow [Migrate from RBAC v1 to RBAC v2](/docs/building-with-kessel/how-to/migrate-from-rbac-v1-to-v2/) which is a guide that will walk you through all the steps of this specific use-case.
</Aside>


## Quick start

### Configure Resources

A new installation of Kessel begins as a blank slate. To integrate a Resource (e.g. for access control), you have to configure a Resource _schema_.

Configure a basic resource that ties into RBAC for permissions. Following is an example of a drive like schema as described in [understanding kessel](../understanding-kessel).

<Steps>
1. Author schemas

    <Code code={documentConfig} lang="yaml" title="document/config.yaml" />

    <Code code={commonRepresentation} lang="json" title="document/common_representation.json" />

    <Code code={driveConfig} lang="yaml" title="document/reporters/drive/config.yaml" />

    <Code code={driveHost} lang="json" title="document/reporters/drive/document.json" />

    <Code code={kesselSchema} lang="text" title="kessel.ksl" />

    <Code code={rbacSchema} lang="text" title="rbac.ksl" />
    
    <Code code={driveSchema} lang="text" title="drive.ksl" />

2. Compile to SpiceDB schema

    Install the KSL compiler directly from github:

    ```bash
    go install github.com/project-kessel/ksl-schema-language/cmd/ksl@latest
    ```

    Alternatively, you can clone the repository and build locally:

    ```bash
    git clone https://github.com/project-kessel/ksl-schema-language.git
    cd ksl-schema-language
    make build
    ```

    Then, you can use the `ksl` command to compile the schemas:

    ```bash
    ksl kessel.ksl rbac.ksl drive.ksl
    ```

    This will generate a `schema.zed` file in the current directory.
    <details>
        <summary>Example generated <code>schema.zed</code> file</summary>

        <Code code={schemaZed} lang="text" title="schema.zed" />
    </details>
</Steps>

### Install and run Kessel with RBAC

<Tabs>
  <TabItem label="Docker compose">
    <Steps>
    1. Start Kessel Inventory

        ```bash
        git clone git@github.com:project-kessel/inventory-api.git
        cd inventory-api
        # copy the schema.zed file we created earlier to deploy/schema.zed
        cp ../schema.zed deploy/schema.zed
        # copy the document resource schema to the inventory API
        cp -r ../document data/schema/resources/
        # preload the schema cache with the document resource
        go run main.go preload-schema
        make inventory-up-relations-ready
        ```

    2. Start Relations and SpiceDB

        ```bash
        git clone git@github.com:project-kessel/relations-api.git
        cd relations-api
        # copy the schema.zed file we created earlier to deploy/schema.zed
        cp ../schema.zed deploy/schema.zed
        make relations-api-up
        # Load the schema in SpiceDB
        # NOTE: `foobar` is a hard-coded default value when
        # running locally. Be sure to change this value for production deployments.
        zed schema write --endpoint localhost:50051 --insecure --token foobar < deploy/schema.zed
        ```

        <Aside type="note">
        The <a href="https://authzed.com/docs/spicedb/getting-started/installing-zed" target="_blank" rel="noopener noreferrer">zed CLI</a> is required to load the schema into SpiceDB.
        </Aside>

    3. Start RBAC

       TODO. For now we will create the Relationships directly
    </Steps>

  </TabItem>
  
  <TabItem label="bonfire">
    <Aside title="Red Hatter?">
    TODO: If you need information on ephemeral cluster access, go here.
    </Aside>
    <Steps>
    1. Start Kessel Inventory

        ```bash
        bonfire deploy kessel -C kessel-inventory
        ```
        
    2. Load Schema

        ```bash
        # create configmap from the schema.zed file we created earlier
        oc create configmap spicedb-schema --dry-run=client --from-file=schema.zed -o yaml > spicedb-schema-configmap.yaml
        # apply the configmap
        oc apply -f spicedb-schema-configmap.yaml
        ```
    
    3. Fetch the API URL and Credentials

        ```bash
        bonfire namespace describe
        ```
    4. Enable port forwarding to Kessel Inventory 

        ```bash
        oc port-forward svc/kessel-inventory-api <your local port>:9000 -n <Name of current project from step 3> 
        oc port-forward svc/kessel-relations-api <your local port>:9000 -n <Name of current project from step 3> 
        ```
        
    </Steps>
  </TabItem>
</Tabs>

### Set up access with RBAC
<Aside title="Note">
If you're following along and used `make relations-api-up`,
your local relations port is 9000.
</Aside>

<Steps>
    0. Install gRPCurl

        gRPCurl is like curl, but for gRPC. See <a href="https://github.com/fullstorydev/grpcurl" target="_blank" rel="noopener noreferrer">the docs</a> for more ways to install.
        ```bash
        go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest
        ```
    1. Link workspace to role binding
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"workspace-1","type":{"name":"workspace","namespace":"rbac"}},"relation":"user_grant","subject":{"subject":{"id":"drive-team-binding","type":{"name":"role_binding","namespace":"rbac"}}}}]}'
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
    2. Grant document permissions to role
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}},"relation":"view_document","subject":{"subject":{"id":"*","type":{"name":"principal","namespace":"rbac"}}}},{"resource":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}},"relation":"edit_document","subject":{"subject":{"id":"*","type":{"name":"principal","namespace":"rbac"}}}},{"resource":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}},"relation":"delete_document","subject":{"subject":{"id":"*","type":{"name":"principal","namespace":"rbac"}}}}]}'
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
     3. Link the role binding to a role
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"drive-team-binding","type":{"name":"role_binding","namespace":"rbac"}},"relation":"granted","subject":{"subject":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}}}}]}'
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
     4. Link the user sarah to the role binding
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"drive-team-binding","type":{"name":"role_binding","namespace":"rbac"}},"relation":"subject","subject":{"subject":{"id":"sarah","type":{"name":"principal","namespace":"rbac"}}}}]}'    
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
    </Steps>

### Report and Check Examples

<SdkExamples content="sdk-examples" />