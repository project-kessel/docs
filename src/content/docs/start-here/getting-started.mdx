---
title: Getting Started with RBAC
description: Step-by-step instructions for installing and running Kessel with your first managed and access controlled resource.
---

import { Aside, Card, CardGrid, LinkButton, Steps, Tabs, TabItem, Code } from '@astrojs/starlight/components';
import SdkExamples from 'src/components/SdkExamples.astro';

import commonRepresentation from 'src/examples/document/common_representation.json?raw';
import documentConfig from 'src/examples/document/config.yaml?raw';
import driveConfig from 'src/examples/document/reporters/drive/config.yaml?raw';
import driveHost from 'src/examples/document/reporters/drive/document.json?raw';
import driveSchema from 'src/examples/drive.ksl?raw';
import rbacSchema from 'src/examples/rbac.ksl?raw';
import kesselSchema from 'src/examples/kessel.ksl?raw';
import schemaZed from 'src/examples/schema.zed?raw';

This tutorial walks you through setting up Kessel from scratch with a basic document management example. 
You'll learn how to configure schemas, set up RBAC permissions, install client libraries, 
and implement both resource reporting and access control using Kessel's APIs across multiple programming languages.

<Aside type="tip" title="Tip: Insights migration guide">
If you are migrating an existing Red Hat Insights application to Kessel, follow [Migrate from RBAC v1 to RBAC v2](/docs/building-with-kessel/how-to/migrate-from-rbac-v1-to-v2/) which is a guide that will walk you through all the steps of this specific use-case.
</Aside>


## Quick start

### Configure Resources

A new installation of Kessel begins as a blank slate. To integrate a Resource (e.g. for access control), you have to configure a Resource _schema_.

Configure a basic resource that ties into RBAC for permissions. Following is an example of a drive like schema as described in [understanding kessel](../understanding-kessel).

<Steps>
1. Author schemas

    <Code code={documentConfig} lang="yaml" title="document/config.yaml" />

    <Code code={driveConfig} lang="yaml" title="document/reporters/drive_service/config.yaml" />

    <Code code={driveHost} lang="json" title="document/reporters/drive_service/document.json" />

    <Code code={kesselSchema} lang="text" title="kessel.ksl" />

    <Code code={rbacSchema} lang="text" title="rbac.ksl" />
    
    <Code code={driveSchema} lang="text" title="drive.ksl" />

2. Compile to SpiceDB schema

    Install the KSL compiler directly from github:

    ```bash
    go install github.com/project-kessel/ksl-schema-language/cmd/ksl@latest
    ```

    Alternatively, you can clone the repository and build locally:

    ```bash
    git clone https://github.com/project-kessel/ksl-schema-language.git
    cd ksl-schema-language
    make build
    ```

    Then, you can use the `ksl` command to compile the schemas:

    ```bash
    ksl kessel.ksl rbac.ksl drive.ksl
    ```

    This will generate a `schema.zed` file in the current directory.
    <details>
        <summary>Example generated <code>schema.zed</code> file</summary>

        <Code code={schemaZed} lang="text" title="schema.zed" />
    </details>
</Steps>

### Install and run Kessel with RBAC

<Tabs>
  <TabItem label="Docker compose">
    <Steps>
    1. Start Kessel Inventory

        ```bash
        git clone git@github.com:project-kessel/inventory-api.git
        cd inventory-api
        make inventory-up-relations-ready
        ```

    2. Start Relations and SpiceDB

        ```bash
        git clone git@github.com:project-kessel/relations-api.git
        cd relations-api
        # copy the schema.zed file we created earlier to deploy/schema.zed
        cp ../schema.zed deploy/schema.zed
        make relations-api-up 
        ```
      
    3. Start RBAC

       TODO. For now we will create the Relationships directly
    </Steps>

  </TabItem>
  
  <TabItem label="bonfire">
    <Aside title="Red Hatter?">
    TODO: If you need information on ephemeral cluster access, go here.
    </Aside>
    <Steps>
    1. Start Kessel Inventory

        ```bash
        bonfire deploy kessel -C kessel-inventory
        ```
        
    2. Load Schema

        ```bash
        # create configmap from the schema.zed file we created earlier
        oc create configmap spicedb-schema --dry-run=client --from-file=schema.zed -o yaml > spicedb-schema-configmap.yaml
        # apply the configmap
        oc apply -f spicedb-schema-configmap.yaml
        ```
    
    3. Fetch the API URL and Credentials

        ```bash
        bonfire namespace describe
        ```
    4. Enable port forwarding to Kessel Inventory 

        ```bash
        oc port-forward svc/kessel-inventory-api <your local port>:9000 -n <Name of current project from step 3> 
        oc port-forward svc/kessel-relations-api <your local port>:9000 -n <Name of current project from step 3> 
        ```
        
    </Steps>
  </TabItem>
</Tabs>

### Set up access with RBAC

<Steps>
    1. Link workspace to role binding
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"workspace-1","type":{"name":"workspace","namespace":"rbac"}},"relation":"user_grant","subject":{"subject":{"id":"drive-team-binding","type":{"name":"role_binding","namespace":"rbac"}}}}]}'
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
    2. Grant document permissions to role
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}},"relation":"view_document","subject":{"subject":{"id":"*","type":{"name":"principal","namespace":"rbac"}}}},{"resource":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}},"relation":"edit_document","subject":{"subject":{"id":"*","type":{"name":"principal","namespace":"rbac"}}}},{"resource":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}},"relation":"delete_document","subject":{"subject":{"id":"*","type":{"name":"principal","namespace":"rbac"}}}}]}'
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
     3. Link the role binding to a role
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"drive-team-binding","type":{"name":"role_binding","namespace":"rbac"}},"relation":"granted","subject":{"subject":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}}}}]}'
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
     4. Link the user sarah to the role binding
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"drive-team-binding","type":{"name":"role_binding","namespace":"rbac"}},"relation":"subject","subject":{"subject":{"id":"sarah","type":{"name":"principal","namespace":"rbac"}}}}]}'    
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
    </Steps>

### Import a client

<Tabs syncKey="language">
    <TabItem label="curl">
    ```bash
    # Set your Kessel endpoint
    KESSEL_BASE_URL="http://localhost:8080"

    # Set common headers for API requests
    HEADERS=(
    -H "Content-Type: application/json"
    )

    # For authenticated environments, add authorization header:
    # HEADERS+=(
    #   -H "Authorization: Bearer $ACCESS_TOKEN"
    # )
    ```
    </TabItem>
    <TabItem label="grpcurl">
    ```bash
    # Set your Kessel gRPC endpoint
    KESSEL_GRPC_ENDPOINT="localhost:9000"

    # For insecure local development:
    GRPC_OPTS="-plaintext"

    # For authenticated environments:
    # GRPC_OPTS="-H 'authorization: Bearer $ACCESS_TOKEN'"
    ```
    </TabItem>
    <TabItem label="Python">
    ```bash
    pip install kessel-sdk
    ```

    #### Basic Client Setup

    ```python
    from kessel.inventory.v1beta2 import ClientBuilder

    # For insecure local development:
    stub, channel = ClientBuilder(KESSEL_ENDPOINT).insecure().build()
    ```

    #### Auth Client Setup

    Install the SDK with auth dependencies:
    ```bash
    pip install "kessel-sdk[auth]"
    ```

    ```python
    from kessel.auth import fetch_oidc_discovery, OAuth2ClientCredentials
    from kessel.inventory.v1beta2 import ClientBuilder

    # Fetch OIDC discovery information
    discovery = fetch_oidc_discovery(ISSUER_URL)

    # Create OAuth2 credentials
    auth_credentials = OAuth2ClientCredentials(
        client_id=CLIENT_ID,
        client_secret=CLIENT_SECRET,
        token_endpoint=discovery.token_endpoint,
    )

    # Build authenticated client
    stub, channel = ClientBuilder(KESSEL_ENDPOINT).oauth2_client_authenticated(auth_credentials).build()
    ```
    </TabItem>
    <TabItem label="Go">
    ```bash
    go get github.com/project-kessel/kessel-sdk-go
    ```

    #### Basic Client Setup

    ```go
    import "github.com/project-kessel/kessel-sdk-go/kessel/inventory/v1beta2"

    // For insecure local development:
    inventoryClient, conn, err := v1beta2.NewClientBuilder(kesselEndpoint).
        Insecure().
        Build()
    if err != nil {
        log.Fatal("Failed to create gRPC client:", err)
    }
    defer conn.Close()
    ```

    #### Auth Client Setup

    ```go
    import (
        "github.com/project-kessel/kessel-sdk-go/kessel/inventory/v1beta2"
        "github.com/project-kessel/kessel-sdk-go/kessel/auth"
    )

    // Fetch OIDC discovery information
    discovered, err := auth.FetchOIDCDiscovery(ctx, os.Getenv("AUTH_DISCOVERY_ISSUER_URL"), auth.FetchOIDCDiscoveryOptions{
        HttpClient: nil, // Optionally specify an http client - defaults to http.DefaultClient
    })
    if err != nil {
        panic(err)
    }

    // Create OAuth2 credentials
    oauthCredentials := auth.NewOAuth2ClientCredentials(
        os.Getenv("AUTH_CLIENT_ID"), 
        os.Getenv("AUTH_CLIENT_SECRET"), 
        discovered.TokenEndpoint,
    )

    // Build authenticated client
    inventoryClient, conn, err := v1beta2.NewClientBuilder(os.Getenv("KESSEL_ENDPOINT")).
        OAuth2ClientAuthenticated(&oauthCredentials, nil).
        Build()
    ```
    </TabItem>
    <TabItem label="Javascript">
    ```bash
    npm install @project-kessel/kessel-sdk
    ```

    #### Basic Client Setup

    ```javascript
    import { ClientBuilder } from "@project-kessel/kessel-sdk/kessel/inventory/v1beta2";

    // For insecure local development:
    const client = new ClientBuilder(process.env.KESSEL_ENDPOINT).insecure().buildAsync();
    ```

    #### Auth Client Setup

    ```javascript
    import { ClientBuilder } from "@project-kessel/kessel-sdk/kessel/inventory/v1beta2";
    import {
        fetchOIDCDiscovery,
        OAuth2ClientCredentials,
    } from "@project-kessel/kessel-sdk/kessel/auth";

    // Fetch OIDC discovery information
    const discovery = await fetchOIDCDiscovery(process.env.AUTH_DISCOVERY_ISSUER_URL);

    // Create OAuth2 credentials
    const oAuth2ClientCredentials = new OAuth2ClientCredentials({
        clientId: process.env.AUTH_CLIENT_ID,
        clientSecret: process.env.AUTH_CLIENT_SECRET,
        tokenEndpoint: discovery.tokenEndpoint,
    });

    // Build authenticated client
    const client = new ClientBuilder(process.env.KESSEL_ENDPOINT)
        .oauth2ClientAuthenticated(oAuth2ClientCredentials)
        .buildAsync();
    ```
    </TabItem>
    <TabItem label="Ruby">
    ```bash
    gem install kessel-sdk
    ```

    #### Basic Client Setup

    ```ruby
    require 'kessel-sdk'
    include Kessel::Inventory::V1beta2
    include Kessel::GRPC

    # For insecure local development:
    client = KesselInventoryService::ClientBuilder.new(ENV.fetch('KESSEL_ENDPOINT', 'localhost:9000'))
                                                    .insecure
                                                    .build
    ```

    #### Auth Client Setup

    ```ruby
    require 'kessel-sdk'
    include Kessel::Inventory::V1beta2
    include Kessel::GRPC
    include Kessel::Auth

    # Fetch OIDC discovery information
    discovery = fetch_oidc_discovery(ENV.fetch('AUTH_DISCOVERY_ISSUER_URL'))

    # Create OAuth2 credentials
    oauth = OAuth2ClientCredentials.new(
        client_id: ENV.fetch('AUTH_CLIENT_ID'),
        client_secret: ENV.fetch('AUTH_CLIENT_SECRET'),
        token_endpoint: discovery.token_endpoint,
    )

    # Build authenticated client
    client = KesselInventoryService::ClientBuilder.new(ENV.fetch('KESSEL_ENDPOINT'))
                                                    .oauth2_client_authenticated(oauth2_client_credentials: oauth)
                                                    .build
    ```
    </TabItem>
    <TabItem label="Java">
    #### Add dependency (Maven)
    ```xml
    <dependency>
      <groupId>io.grpc</groupId>
      <artifactId>grpc-netty-shaded</artifactId>
    </dependency>
    <dependency>
      <groupId>org.project-kessel</groupId>
      <artifactId>kessel-sdk</artifactId>
      <version>1.0.0</version>
    </dependency>
    <!-- Optional: Auth support for OAuth2 client credentials -->
    <dependency>
      <groupId>com.nimbusds</groupId>
      <artifactId>oauth2-oidc-sdk</artifactId>
      <version>11.28</version>
    </dependency>
    ```

    #### Add dependency (Gradle)
    ```gradle
    dependencies {
      implementation 'io.grpc:grpc-netty-shaded'
      implementation "org.project-kessel:kessel-sdk:1.0.0"
      // Optional: Auth support for OAuth2 client credentials
      implementation "com.nimbusds:oauth2-oidc-sdk:11.28"
    }
    ```

    #### Basic Client Setup
    ```java
    import com.nimbusds.jose.util.Pair;
    import io.grpc.ManagedChannel;
    import org.project_kessel.api.inventory.v1beta2.ClientBuilder;
    import static org.project_kessel.api.inventory.v1beta2.KesselInventoryServiceGrpc.KesselInventoryServiceBlockingStub;

    String kesselEndpoint = System.getenv().getOrDefault("KESSEL_ENDPOINT", "localhost:9000");
    Pair<KesselInventoryServiceBlockingStub, ManagedChannel> clientAndChannel =
        new ClientBuilder(kesselEndpoint)
            .insecure()
            .build();
    KesselInventoryServiceBlockingStub client = clientAndChannel.getLeft();
    ```

    #### Auth Client Setup
    ```java
    import com.nimbusds.jose.util.Pair;
    import io.grpc.ManagedChannel;
    import org.project_kessel.api.auth.ClientConfigAuth;
    import org.project_kessel.api.auth.OAuth2ClientCredentials;
    import org.project_kessel.api.auth.OIDCDiscovery;
    import org.project_kessel.api.auth.OIDCDiscoveryMetadata;
    import org.project_kessel.api.inventory.v1beta2.ClientBuilder;
    import static org.project_kessel.api.inventory.v1beta2.KesselInventoryServiceGrpc.KesselInventoryServiceBlockingStub;

    String issuerUrl = System.getenv("AUTH_DISCOVERY_ISSUER_URL");
    OIDCDiscoveryMetadata discovery = OIDCDiscovery.fetchOIDCDiscovery(issuerUrl);
    ClientConfigAuth authConfig = new ClientConfigAuth(
        System.getenv("AUTH_CLIENT_ID"),
        System.getenv("AUTH_CLIENT_SECRET"),
        discovery.tokenEndpoint()
    );
    OAuth2ClientCredentials oauth = new OAuth2ClientCredentials(authConfig);

    Pair<KesselInventoryServiceBlockingStub, ManagedChannel> clientAndChannel =
        new ClientBuilder(System.getenv().getOrDefault("KESSEL_ENDPOINT", "localhost:9000"))
            .oauth2ClientAuthenticated(oauth)
            .build();
    KesselInventoryServiceBlockingStub client = clientAndChannel.getLeft();
    ```
    </TabItem>
</Tabs>

### Report resources

<SdkExamples content="sdk-examples-report-resources" />

### Enforce access

<SdkExamples content="sdk-examples-check" />
