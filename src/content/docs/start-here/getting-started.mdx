---
title: Getting Started with RBAC
description: Step-by-step instructions for installing and running Kessel with your first managed and access controlled resource.
---

import { Aside, Card, CardGrid, LinkButton, Steps, Tabs, TabItem, Code } from '@astrojs/starlight/components';
import SdkExamples from 'src/components/SdkExamples.astro';

import commonRepresentation from 'src/examples/document/common_representation.json?raw';
import documentConfig from 'src/examples/document/config.yaml?raw';
import driveConfig from 'src/examples/document/reporters/drive_service/config.yaml?raw';
import driveHost from 'src/examples/document/reporters/drive_service/document.json?raw';
import driveSchema from 'src/examples/drive.ksl?raw';
import rbacSchema from 'src/examples/rbac.ksl?raw';
import kesselSchema from 'src/examples/kessel.ksl?raw';
import schemaZed from 'src/examples/schema.zed?raw';

TODO: Tutorial to run through end to end basic usage of Kessel with very basic demo/toy code, using the client libraries.
Use the Tabs component to show code examples with different tabs for language (e.g. python vs go).

NOTE: This prose is placeholder. Feel free to update.

<Aside type="tip" title="Tip: Insights migration guide">
If you are migrating an existing Red Hat Insights application to Kessel, follow [Migrate from RBAC v1 to RBAC v2](/docs/building-with-kessel/how-to/migrate-from-rbac-v1-to-v2/) which is a guide that will walk you through all the steps of this specific use-case.
</Aside>


## Quick start

### Configure Resources

A new installation of Kessel begins as a blank slate. To integrate a Resource (e.g. for access control), you have to configure a Resource _schema_.

Configure a basic resource that ties into RBAC for permissions. Following is an example of a drive like schema as described in [understanding kessel](../understanding-kessel).

<Steps>
1. Author schemas

    <Code code={documentConfig} lang="yaml" title="document/config.yaml" />

    <Code code={driveConfig} lang="yaml" title="document/reporters/drive_service/config.yaml" />

    <Code code={driveHost} lang="json" title="document/reporters/drive_service/document.json" />

    <Code code={kesselSchema} lang="text" title="kessel.ksl" />

    <Code code={rbacSchema} lang="text" title="rbac.ksl" />
    
    <Code code={driveSchema} lang="text" title="drive.ksl" />

2. Compile to SpiceDB schema

    Install the KSL compiler directly from github:

    ```bash
    go install github.com/project-kessel/ksl-schema-language/cmd/ksl@latest
    ```

    Alternatively, you can clone the repository and build locally:

    ```bash
    git clone https://github.com/project-kessel/ksl-schema-language.git
    cd ksl-schema-language
    make build
    ```

    Then, you can use the `ksl` command to compile the schemas:

    ```bash
    ksl kessel.ksl rbac.ksl drive.ksl
    ```

    This will generate a `schema.zed` file in the current directory.
    <details>
        <summary>Example generated <code>schema.zed</code> file</summary>

        <Code code={schemaZed} lang="text" title="schema.zed" />
    </details>
</Steps>

### Install and run Kessel with RBAC

<Tabs>
  <TabItem label="Docker compose">
    <Steps>
    1. Start Kessel Inventory

        ```bash
        git clone git@github.com:project-kessel/inventory-api.git
        cd inventory-api
        make inventory-up-relations-ready
        ```

    2. Start Relations and SpiceDB

        ```bash
        git clone git@github.com:project-kessel/relations-api.git
        cd relations-api
        curl -o deploy/schema.zed https://raw.githubusercontent.com/RedHatInsights/rbac-config/refs/heads/master/configs/prod/schemas/schema.zed
        make relations-api-up 
        ```
      
    3. Start RBAC

       TODO. For now we will create the Relationships directly
    </Steps>

  </TabItem>
  
  <TabItem label="bonfire">
    <Aside title="Red Hatter?">
    TODO: If you need information on ephemeral cluster access, go here.
    </Aside>
    <Steps>
    1. Start Kessel Inventory

        ```bash
        bonfire deploy kessel -C kessel-inventory
        ```
        
    2. Load Schema

        ```bash
        oc apply -f https://gist.githubusercontent.com/akoserwal/a061a2959862caa653aa8c8836db874b/raw/7cd73fd045ed8f30c850349bb7ff3264b2d35c8e/spicedb-schema-configmap.yaml
        ```
    
    3. Fetch the API URL and Credentials

        ```bash
        bonfire namespace describe
        ```
    4. Enable port forwarding to Kessel Inventory 

        ```bash
        oc port-forward svc/kessel-inventory-api <your local port>:9000 -n <Name of current project from step 3> 
        oc port-forward svc/kessel-relations-api <your local port>:9000 -n <Name of current project from step 3> 
        ```
        
    </Steps>
  </TabItem>
</Tabs>

### Set up access with RBAC

<Steps>
    1. Link workspace to role binding
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"workspace-1","type":{"name":"workspace","namespace":"rbac"}},"relation":"user_grant","subject":{"subject":{"id":"drive-team-binding","type":{"name":"role_binding","namespace":"rbac"}}}}]}'
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
    2. Grant document permissions to role
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}},"relation":"view_document","subject":{"subject":{"id":"*","type":{"name":"principal","namespace":"rbac"}}}},{"resource":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}},"relation":"edit_document","subject":{"subject":{"id":"*","type":{"name":"principal","namespace":"rbac"}}}}]}'
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
     3. Link the role binding to a role
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"drive-team-binding","type":{"name":"role_binding","namespace":"rbac"}},"relation":"granted","subject":{"subject":{"id":"drive-admin-role","type":{"name":"role","namespace":"rbac"}}}}]}'
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
     4. Link the user sarah to the role binding
        ```bash
        MESSAGE='{"tuples":[{"resource":{"id":"drive-team-binding","type":{"name":"role_binding","namespace":"rbac"}},"relation":"subject","subject":{"subject":{"id":"sarah","type":{"name":"principal","namespace":"rbac"}}}}]}'    
        grpcurl -plaintext -d $MESSAGE \
        localhost: <your local port for relations> \
        kessel.relations.v1beta1.KesselTupleService.CreateTuples
        ```
    </Steps>

### Import a client

<Tabs syncKey="language">
  <TabItem label="Python">
  ```bash
  pip install kessel-sdk
  ```
  </TabItem>
  <TabItem label="Go">
  ```bash
  go get github.com/project-kessel/kessel-sdk-go
  ```
  </TabItem>
  <TabItem label="Javascript">
  ```bash
  npm install @project-kessel/kessel-sdk
  ```
  </TabItem>
  <TabItem label="Ruby">
  ```bash
  gem install kessel-sdk
  ```
  </TabItem>
  <TabItem label="Java (Maven)">
  TODO: Update once we have a Java SDK
  ```xml
  <maven coords></maven coords>
  ```
  </TabItem>
  <TabItem label="Java (Gradle)">
  TODO: Update once we have a Java SDK
  ```gradle
  gradle coords
  ```
  </TabItem>
</Tabs>

### Report resources

<SdkExamples content="sdk-examples-report-resources" />

### Enforce access

<SdkExamples content="sdk-examples-check" />
