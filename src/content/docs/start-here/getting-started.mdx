---
title: Getting Started with RBAC
description: Step-by-step instructions for installing and running Kessel with your first managed and access controlled resource.
---

import { Aside, Badge, Card, CardGrid, LinkButton, Steps, Tabs, TabItem, Code } from '@astrojs/starlight/components';
import SdkExamples from 'src/components/SdkExamples.astro';

import commonRepresentation from 'src/examples/document/common_representation.json?raw';
import documentConfig from 'src/examples/document/config.yaml?raw';
import driveConfig from 'src/examples/document/reporters/drive/config.yaml?raw';
import driveHost from 'src/examples/document/reporters/drive/document.json?raw';
import driveSchema from 'src/examples/drive.ksl?raw';
import rbacSchema from 'src/examples/rbac.ksl?raw';
import kesselSchema from 'src/examples/kessel.ksl?raw';
import schemaZed from 'src/examples/schema.zed?raw';
import createRoleScript from 'src/examples/scripts/create-role.sh?raw';
import createRoleBindingScript from 'src/examples/scripts/create-role-binding.sh?raw';

**This tutorial walks you through setting up Kessel from scratch with a basic document management example.**
You'll learn how to configure schemas, set up RBAC permissions, install client libraries, 
and implement both resource reporting and access control using Kessel's APIs across multiple programming languages.

<Aside type="tip" title="Tip: Insights migration guide">
If you are migrating an existing Red Hat Insights application to Kessel, follow [Migrate from RBAC v1 to RBAC v2](/docs/building-with-kessel/how-to/migrate-from-rbac-v1-to-v2/) which is a guide that will walk you through all the steps of this specific use-case.
</Aside>

<Aside type="caution" title="Under Construction">Many aspects of Kessel are under construction, and this guide contains various workarounds and temporary solutions. 
Take a look at the [roadmap](#next-steps-and-roadmap) to learn more about where we're going.</Aside>

## Quick start


### Prerequisites

Let's get some prerequisites out of the way. These are temporary solutions, so don't worry about them too much.

<Steps>
1. We need a schema compiler.

    <Tabs>
      <TabItem label="Install via go install (recommended)">
        Install the KSL compiler directly from GitHub:

        ```bash
        go install github.com/project-kessel/ksl-schema-language/cmd/ksl@latest
        ```
      </TabItem>
      <TabItem label="Build from source">
        Alternatively, you can clone the repository and build locally:

        ```bash
        git clone https://github.com/project-kessel/ksl-schema-language.git
        cd ksl-schema-language
        make build
        ```
      </TabItem>
    </Tabs>

2. We need gRPCurl to perform some setup operations. gRPCurl is like curl, but for gRPC.

    <Tabs>
      <TabItem label="Go">
        ```bash
        go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest
        ```
      </TabItem>
      <TabItem label="Homebrew">
        ```bash
        brew install grpcurl
        ```
      </TabItem>
      <TabItem label="Other">
        See <a href="https://github.com/fullstorydev/grpcurl#installation" target="_blank" rel="noopener noreferrer">the grpcurl docs</a> for additional installation methods including Snap, Docker, and prebuilt binaries.
      </TabItem>
    </Tabs>

3. And we need to configure some built-in schemas manually. We'll talk more about schemas in the next section.

    <Code code={kesselSchema} lang="text" title="kessel.ksl" />

    <Code code={rbacSchema} lang="text" title="rbac.ksl" />

</Steps>

### Configure Resources

Now the interesting part. To protect and share your application's <i>resources</i>, you first have to configure resource _schema_.

The following is an example of a drive like schema as described in [understanding kessel](../understanding-kessel).
It will consistent of a simple document which is organized into Kessel's Workspaces.
It will have assignable permissions which leverage the common Kessel RBAC model.


<Steps>
1. **First we have to tell Kessel about the resource.** We include its attributes and relationships, which are used for access control.

    <Code code={documentConfig} lang="yaml" title="document/config.yaml" />

    <Code code={commonRepresentation} lang="json" title="document/common_representation.json" />

    <Code code={driveConfig} lang="yaml" title="document/reporters/drive/config.yaml" />

    <Code code={driveHost} lang="json" title="document/reporters/drive/document.json" />

    
    <Code code={driveSchema} lang="text" title="drive.ksl" />

2. Compile to SpiceDB schema

    Install the KSL compiler directly from github:

    ```bash
    go install github.com/project-kessel/ksl-schema-language/cmd/ksl@latest
    ```

    Alternatively, you can clone the repository and build locally:

    ```bash
    git clone https://github.com/project-kessel/ksl-schema-language.git
    cd ksl-schema-language
    make build
    ```

    Then, you can use the `ksl` command to compile the schemas:

    ```bash
    ksl kessel.ksl rbac.ksl drive.ksl
    ```

    This will generate a `schema.zed` file in the current directory.
    <details>
        <summary>Example generated <code>schema.zed</code> file</summary>

        <Code code={schemaZed} lang="text" title="schema.zed" />
    </details>
</Steps>

### Install and run Kessel

<Tabs>
  <TabItem label="Docker compose">
    <Steps>
    1. **Start Kessel Inventory**. Inventory is the service that stores the resources and their relationships.

        ```bash
        git clone git@github.com:project-kessel/inventory-api.git
        cd inventory-api
        cp -r ../document data/schema/resources/
        # preload the schema cache with the document resource
        go run main.go preload-schema
        make inventory-up-relations-ready
        ```

    2. **Start Relations and [SpiceDB](https://authzed.com/docs/spicedb/getting-started/discovering-spicedb)**. These form the underlying relationship storage and query engine based on relationship-based access control.

        ```bash
        git clone git@github.com:project-kessel/relations-api.git
        cd relations-api
        cp ../schema.zed deploy/schema.zed
        make relations-api-up
        ```

        <Aside type="tip">
        If you modify your schema, run `make relations-api-down`, then copy the updated `schema.zed` as above and run `make relations-api-up` again.
        </Aside>
    </Steps>

  </TabItem>
  
  <TabItem label="bonfire">
    <Aside title="Red Hatter?">
    TODO: If you need information on ephemeral cluster access, go here.
    </Aside>
    <Steps>
    1. Start Kessel Inventory

        ```bash
        bonfire deploy kessel -C kessel-inventory
        ```
        
    2. Load Schema

        ```bash
        # create configmap from the schema.zed file we created earlier
        oc create configmap spicedb-schema --dry-run=client --from-file=schema.zed -o yaml > spicedb-schema-configmap.yaml
        # apply the configmap
        oc apply -f spicedb-schema-configmap.yaml
        ```
    
    3. Fetch the API URL and Credentials

        ```bash
        bonfire namespace describe
        ```
    4. Enable port forwarding to Kessel Inventory 

        ```bash
        oc port-forward svc/kessel-inventory-api <your local port>:9000 -n <Name of current project from step 3> 
        oc port-forward svc/kessel-relations-api <your local port>:9000 -n <Name of current project from step 3> 
        ```
        
    </Steps>
  </TabItem>
</Tabs>

### Set up access with RBAC

Now Kessel is running. You configured the "built-in" RBAC schemas in prerequisites.
Then you configured a document resource and extended RBAC resources like <i>role</i> and <i>workspace</i> with relevant permissions.

To get access, we need three things to come together:

- One or more permissions. These are aggregated into a role.
- A resource. These can be aggregated into a workspace (or other resources as defined by schema).
- A subject (e.g. a user). These can be aggregated into a group.

The union of these three things is a <i>role binding</i>. So for our next step, we will create a role to group together some permissions.
Then, we'll create a role binding by combining a **role** (the one we just created), a **resource** (some workspace), and a **subject** (some user).


This results in that user having the access described by the role to that workspace, and any documents with a "parent" relation to it. 

<Steps>
1. **Create a role**

    A role defines a set of permissions. Edit the `ROLE_NAME` and `PERMISSIONS` variables to customize, then run the script.

    <Code code={createRoleScript} lang="bash" title="create-role.sh" />

2. **Create a role binding**

    A role binding grants a user access to a role for a specific resource (e.g., a workspace).
    Edit the `ROLE_NAME`, `USER_ID`, and `RESOURCE_ID` variables, then run the script.
    The binding ID is auto-generated from these inputs.

    <Code code={createRoleBindingScript} lang="bash" title="create-role-binding.sh" />

</Steps>

### Report and Check Examples

<SdkExamples content="sdk-examples" />

## Next steps and roadmap

### Exercises

Try to experiment with the schema and relationships. Can you...

- Create a new role?
- Assign that role to a user?
- Add a new permission to the document?

### How to contribute

We're open to contributions! Check us out on GitHub at [project-kessel](https://github.com/project-kessel).

### Where are we going?

| Feature                 | Today                                                                                       | Roadmap / What's Next                                                                              |
|-------------------------|---------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| **Schema Language**     | Use multiple files and languages for schema, with overlap and duplicated information        | Unify all these into a single schema languageâ€”no duplication or repeated information               |
| **Configuration Method**| Edit schema and config via files                                                            | Configure everything at runtime via an API                                                         |
| **RBAC Management**     | Use temporary scripts or the pre-Kessel RBAC v1 API                                         | Use an RBAC management API (v2) to encapsulate access grants and workspace management              |