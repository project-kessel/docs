---
import ParameterList from "./ParameterList.astro";
import ParameterDetail from "./ParameterDetail.astro";
import DescriptionBlock from "./DescriptionBlock.astro";
import type { MethodLike } from "../../schemas/client-package";
import type { MarkdownHeading } from "astro";
import LanguagesIndicator from "./LanguagesIndicator.astro";

interface Props {
  functions?: MethodLike[];
}

const { functions } = Astro.props;

// Export heading generation function for TOC middleware
export function generateFunctionHeadings(functionData: MethodLike): MarkdownHeading[] {
    return [
        {
            depth: 3,
            slug: `function-${functionData.name}`,
            text: functionData.name,
        },
    ];
}

// Export heading generation function for TOC middleware
export function generateFunctionsHeadings(
  functions?: MethodLike[]
): MarkdownHeading[] {
  if (!functions || functions.length === 0) {
    return [];
  }

  const headings = [
    {
      depth: 2,
      slug: "functions",
      text: "Functions",
    },
  ];

  for (const functionData of functions) {
    headings.push(...generateFunctionHeadings(functionData));
  }

  return headings;
}
---

{
  functions && (
    <>
      <h2 id="functions">Functions</h2>
      <ul>
        {functions.map((func) => (
          <li id={`function-${func.name}`}>
            <code>{func.name}</code>
            {func.async && <code> async</code>}
            (<ParameterList params={func.params} />)
            {func.returns && (
              <>
                :{" "}
                {func.returns.link ? (
                  <a href={func.returns.link}>
                    <code>{func.returns.name}</code>
                  </a>
                ) : (
                  <code>{func.returns.name}</code>
                )}
              </>
            )}
            <LanguagesIndicator languages={func.languages} context="function" />
            <DescriptionBlock description={func.description} />
            <ParameterDetail params={func.params} />
          </li>
        ))}
      </ul>
    </>
  )
}
