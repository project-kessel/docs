---
import ParameterList from "./ParameterList.astro";
import ParameterDetail from "./ParameterDetail.astro";
import DescriptionBlock from "./DescriptionBlock.astro";
import type { MethodLike } from "../../schemas/client-package";
import type { MarkdownHeading } from "astro";
import { Badge } from "@astrojs/starlight/components";

interface Props {
  functions?: MethodLike[];
}

const { functions } = Astro.props;

// Export heading generation function for TOC middleware
export function generateFunctionsHeadings(
  functions?: MethodLike[]
): MarkdownHeading[] {
  if (!functions || functions.length === 0) {
    return [];
  }

  return [
    {
      depth: 2,
      slug: "functions",
      text: "Functions",
    },
  ];
}
---

{
  functions && (
    <>
      <h2 id="functions">Functions</h2>
      <ul>
        {functions.map((func) => (
          <li>
            <code>{func.name}</code>
            {func.async && <code> async</code>}
            (<ParameterList params={func.params} />)
            {func.returns && (
              <>
                :{" "}
                {typeof func.returns === "string" ? (
                  <code>{func.returns}</code>
                ) : func.returns?.link ? (
                  <a href={func.returns.link}>
                    <code>{func.returns.name}</code>
                  </a>
                ) : (
                  <code>{func.returns?.name}</code>
                )}
              </>
            )}
            {func.languages && func.languages.length > 0 && (
              <div
                class="mt-1 flex items-center gap-2"
                title="This function is implemented only in these SDK languages"
              >
                <span class="text-xs text-gray-600 dark:text-gray-400">
                  Only in
                </span>
                {func.languages.map((lang) => (
                  <Badge text={lang} size="small" />
                ))}
              </div>
            )}
            <DescriptionBlock description={func.description} />
            <ParameterDetail params={func.params} />
          </li>
        ))}
      </ul>
    </>
  )
}
